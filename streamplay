#! /bin/bash

# originaly from http://tinyurl.com/twitch-linux from taladan
# www.youtube.com/user/taladan

# gist created by brodul

INRES="1920x1080" # input resolution
#OUTRES="1024x640" # Output resolution
OUTRES="1280x720" # Output resolution
FPS="30" # target FPS
QUAL="medium" # one of the many FFMPEG preset on (k)ubuntu found in /usr/share/ffmpeg
# If you have low bandwidth, put the qual preset on 'fast' (upload bandwidth)
# If you have medium bandwitch put it on normal to medium

# Write your key in a file named .twitch_key in your home directory
STREAM_KEY=$(cat ~/.twitch_key) # This is your streamkey generated by jtv/twitch found at: http://www.justin.tv/broadcast/adv_other

ffmpeg \
-f x11grab -s $INRES -r "$FPS" -i :0.0+1440+0 \
-f alsa -ac 2 -i pulse \
-vcodec libx264 -pix_fmt yuv420p -s $OUTRES -preset $QUAL \
-acodec libmp3lame -ar 44100 -b:a 612000 -bufsize 512k \
-vf "movie=/home/pdq/Pictures/index.png [watermark]; [in][watermark] overlay=main_w-overlay_w-0:main_h-overlay_h-0 [out]" \
-f flv "rtmp://live-jfk.justin.tv/app/$STREAM_KEY"
#-f flv "rtmp://live.twitch.tv/app/$STREAM_KEY"

# ffmpeg \
# -f x11grab -s $INRES -r "$FPS" -i :0.0+1440+0 \
# -f alsa -ac 2 -i pulse \
# -vcodec libx264 -crf 30 -s $OUTRES -preset $QUAL \
# -acodec libmp3lame -ab 96k -ar 44100 -threads 0 -pix_fmt yuv420p \
# -f flv "rtmp://live-jfk.justin.tv/app/$STREAM_KEY"
